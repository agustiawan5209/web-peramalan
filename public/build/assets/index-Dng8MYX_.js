var B=Object.defineProperty;var J=(p,a,l)=>a in p?B(p,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):p[a]=l;var S=(p,a,l)=>J(p,typeof a!="symbol"?a+"":a,l);import{r as h,j as e,L as z,a as Q}from"./app-CwzCkPZf.js";import{B as L}from"./button-D6mSC6kj.js";import{C as U,a as W}from"./card-9J3xDkxc.js";import{L as G,I as H}from"./label-DbovscGM.js";import{A as X}from"./app-layout-CkMliSv0.js";import E from"./fpgrowth-all-DcSWvvUZ.js";import"./index-B0Fnjf-p.js";import"./waves-Iue_lL-E.js";import"./utils-jAU0Cazi.js";import"./createLucideIcon-B5A65qtx.js";import"./index-BsY3OrU1.js";import"./chevron-right-DTNbnOAr.js";import"./toast-CjWt9tqQ.js";import"./Combination-5J8sRYF3.js";import"./nav-user-pmqD2dbs.js";import"./index-Da9yyfr_.js";import"./chart-column-IxKl06iX.js";import"./database-CPSVj6de.js";import"./table-hQ7uTzO3.js";import"./fpgrowth-CgZhDACL.js";class Y{constructor(a,l=3,o=100){S(this,"transactions");S(this,"k");S(this,"maxIterations");S(this,"numericData",[]);S(this,"uniqueItems",[]);this.transactions=a,this.k=l,this.maxIterations=o,this.preprocessData()}preprocessData(){const a=new Set;this.transactions.forEach(l=>{l.forEach(o=>a.add(o))}),this.uniqueItems=Array.from(a),this.numericData=this.transactions.map(l=>this.uniqueItems.map(o=>l.includes(o)?1:0))}euclideanDistance(a,l){return Math.sqrt(a.reduce((o,I,w)=>o+Math.pow(I-l[w],2),0))}run(){if(this.transactions.length===0||this.numericData.length===0)return{clusters:{rendah:[],sedang:[],tinggi:[]},centroids:[],associations:[],featureImportance:[],uniqueItems:[]};let a=[];const l=this.numericData[0].length;for(let s=0;s<this.k;s++){const t=Math.floor(Math.random()*this.numericData.length);a.push([...this.numericData[t]])}let o=Array(this.k).fill([]),I=[],w=0;for(;w<this.maxIterations&&(o=Array(this.k).fill([]).map(()=>[]),this.numericData.forEach((s,t)=>{let r=1/0,c=0;a.forEach((d,j)=>{const y=this.euclideanDistance(s,d);y<r&&(r=y,c=j)}),o[c].push(t)}),JSON.stringify(o)!==JSON.stringify(I));)I=o.map(s=>[...s]),a=o.map(s=>{if(s.length===0)return a[o.indexOf(s)];const t=Array(l).fill(0);return s.forEach(r=>{this.numericData[r].forEach((d,j)=>{t[j]+=d})}),t.map(r=>r/s.length)}),w++;const i=o.map((s,t)=>({indices:s,centroid:a[t]})).sort((s,t)=>s.indices.length-t.indices.length),D={rendah:i[0].indices.map(s=>this.transactions[s]),sedang:i[1].indices.map(s=>this.transactions[s]),tinggi:i[2].indices.map(s=>this.transactions[s])},R=this.uniqueItems.map(s=>{this.uniqueItems.indexOf(s);const t=this.transactions.filter(c=>c.includes(s)).length/this.transactions.length;let r=0;return Object.values(D).forEach(c=>{const d=c.filter(j=>j.includes(s)).length/(c.length||1);r+=Math.abs(d-t)}),{item:s,influence:r}}),M=this.uniqueItems.map(s=>{const t=this.uniqueItems.indexOf(s),r=i.map(b=>{const u=b.indices.map(g=>this.numericData[g][t]),N=u.reduce((g,C)=>g+C,0)/(u.length||1),T=u.reduce((g,C)=>g+Math.pow(C-N,2),0)/(u.length||1);return{mean:N,variance:T}}),c=this.numericData.reduce((b,u)=>b+u[t],0)/this.numericData.length,d=r.reduce((b,u,N)=>b+i[N].indices.length*Math.pow(u.mean-c,2),0)/this.numericData.length,j=r.reduce((b,u)=>b+u.variance,0)/this.k,y=d/(j+1e-9);return{item:s,importance:y,clusterVariances:{rendah:r[0].variance,sedang:r[1].variance,tinggi:r[2].variance}}}),A=R.sort((s,t)=>t.influence-s.influence),q=M.sort((s,t)=>t.importance-s.importance);return{clusters:D,centroids:i.map(s=>s.centroid),associations:A,featureImportance:q,uniqueItems:this.uniqueItems}}}function be({breadcrumb:p,titlePage:a,transaksiPanen:l,transactionNumerical:o,kriteria:I}){const w=h.useMemo(()=>p?p.map(n=>({title:n.title,href:n.href})):[],[p]),[i,D]=h.useState({clusters:{rendah:[],sedang:[],tinggi:[]},centroids:[],associations:[],featureImportance:[],uniqueItems:[]}),[R,M]=h.useState({rendah:[],sedang:[],tinggi:[]}),A=l||[],q=new Y(A),s=()=>{const n=q.run();if(n){M(n.clusters);const v=Object.values(n.clusters).reduce((x,_,f)=>{let m="hasil_panen";f===0?m="hasil_panen_rendah":f===1?m="hasil_panen_sedang":f===2&&(m="hasil_panen_tinggi");const k=_.map(F=>F.map(P=>P.includes("hasil_panen")?m:P));return f===0?x.rendah=k:f===1?x.sedang=k:f===2&&(x.tinggi=k),x},{rendah:[],sedang:[],tinggi:[]});D({clusters:v,centroids:n.centroids,featureImportance:n.featureImportance,associations:n.associations,uniqueItems:n.uniqueItems})}},[t,r]=h.useState(20),[c,d]=h.useState(70),[j,y]=h.useState([]),[b,u]=h.useState([]),[N,T]=h.useState([]),[g,C]=h.useState([]),[O,K]=h.useState(!1);h.useEffect(()=>{const n=N.reduce((x,{name:_,count:f})=>{let m=_.includes("_")?_.split("_")[0]:_;const k=I.find(F=>F.nama.toLowerCase().includes(m));return k&&(m=k.nama),x[m]?x[m].count+=f:x[m]={name:m,count:f},x},{}),v=Object.values(n);C(v)},[N]);const V=async()=>{if(g)try{const n=await Q.post(route("store.kriteria.model"),{hasil:g.map(v=>v.name)});n.status==200&&(console.log(n.data),K(!0))}catch(n){console.log(n)}};return e.jsx(e.Fragment,{children:e.jsxs(X,{breadcrumbs:w,children:[e.jsx(z,{title:a}),e.jsxs("div",{className:"fp-growth-container rounded-lg bg-white p-4 shadow-lg",children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Hasil Aturan Asosiasi FP-Growth"}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium text-yellow-600",children:"Peringatan: Proses ini mungkin memakan waktu lama jika data transaksi sangat besar"}),e.jsxs("p",{className:"mt-1",children:[e.jsx("span",{className:"font-semibold",children:"Support Threshold:"})," Minimum support (0-100%) untuk itemset dianggap frequent"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Confidence Threshold:"})," Minimum confidence (0-100%) untuk aturan dianggap valid"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{htmlFor:"support_threshold",className:"w-40",children:"Support Threshold (%)"}),e.jsx(H,{id:"support_threshold",type:"number",min:"0",max:"100",step:"1",value:t,onChange:n=>r(Math.min(100,Math.max(0,Number(n.target.value)))),className:"w-24"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{htmlFor:"confidence_threshold",className:"w-40",children:"Confidence Threshold (%)"}),e.jsx(H,{id:"confidence_threshold",type:"number",min:"0",max:"100",step:"1",value:c,onChange:n=>d(Math.min(100,Math.max(0,Number(n.target.value)))),className:"w-24"})]})]})]}),e.jsx("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsx(L,{onClick:s,type:"button",variant:"default",className:"rounded-md px-4 py-2 font-medium text-white transition-colors",children:"Jalankan FP-Growth"})}),e.jsx("section",{className:"space-y-8 rounded-xl bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Hasil Clustering K-means"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsx("div",{className:"cluster-card rounded-lg border border-blue-100 bg-blue-50 p-4",children:e.jsxs("h3",{className:"mb-3 text-lg font-medium text-blue-800",children:["Cluster Rendah ",e.jsxs("span",{className:"text-blue-600",children:["(",i.clusters.rendah.length," transaksi)"]})]})}),e.jsx("div",{className:"cluster-card rounded-lg border border-purple-100 bg-purple-50 p-4",children:e.jsxs("h3",{className:"mb-3 text-lg font-medium text-purple-800",children:["Cluster Sedang ",e.jsxs("span",{className:"text-purple-600",children:["(",i.clusters.sedang.length," transaksi)"]})]})}),e.jsx("div",{className:"cluster-card rounded-lg border border-green-100 bg-green-50 p-4",children:e.jsxs("h3",{className:"mb-3 text-lg font-medium text-green-800",children:["Cluster Tinggi ",e.jsxs("span",{className:"text-green-600",children:["(",i.clusters.tinggi.length," transaksi)"]})]})})]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[g.length>0&&e.jsx(U,{className:"col-span-full overflow-hidden rounded-xl border-0 shadow-sm",children:e.jsx(W,{className:"p-6",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Hasil Indikator Terpilih"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Dari hasil pola asosiasi FP-Growth"})]}),e.jsx(L,{type:"button",onClick:V,variant:"outline",disabled:O,className:"border-primary text-primary hover:bg-primary/10",children:O?"Indikator Berhasil Tersimpan":"Simpan Indikator"})]}),e.jsx("div",{className:"rounded-lg bg-gray-50 p-4",children:e.jsx("ul",{className:"space-y-3",children:g.map((n,v)=>e.jsxs("li",{className:"flex items-center justify-between rounded-md bg-white p-3 shadow-xs transition-all hover:shadow-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:n.name}),e.jsxs("span",{className:"inline-flex items-center justify-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800",children:[n.count," rules"]})]},v))})})]})})}),i.clusters&&i.clusters.rendah&&e.jsx(E,{transactions:i.clusters.rendah,title:"Rendah",support_threshold:t,confidence_threshold:c,setConfidenceThreshold:d,setSupportThreshold:r,setAssociationResult:y}),i.clusters&&i.clusters.sedang&&e.jsx(E,{transactions:i.clusters.sedang,title:"Sedang",support_threshold:t,confidence_threshold:c,setConfidenceThreshold:d,setSupportThreshold:r,setAssociationResult:u}),i.clusters&&i.clusters.tinggi&&e.jsx(E,{transactions:i.clusters.tinggi,title:"Tinggi",support_threshold:t,confidence_threshold:c,setConfidenceThreshold:d,setSupportThreshold:r,setAssociationResult:T}),!i.clusters&&e.jsx("h2",{className:"mb-4 text-2xl font-bold text-destructive",children:"Peringatan : Data Hasil Panen Harus lebih dari 5"})]})]})]})})}export{be as default};
