import{r as h,j as t}from"./app-CwzCkPZf.js";import{T as L,a as M,b as R,c as y,d as z,e as N}from"./table-hQ7uTzO3.js";import{f as A}from"./fpgrowth-CgZhDACL.js";import"./utils-jAU0Cazi.js";const X=({transactions:u,support_threshold:F,confidence_threshold:I,setSupportThreshold:J,setConfidenceThreshold:O,setAssociationResult:w,title:_})=>{const[g,P]=h.useState([]),[D,G]=h.useState({antecedents:[],consequents:[],overall:[]}),[T,b]=h.useState(!1),[v,k]=h.useState(null),f=h.useRef(null),B=async()=>{f.current&&clearTimeout(f.current),k(null),f.current=setTimeout(()=>b(!0),1e3);try{if(u.length===0)throw new Error("Tidak ada transaksi untuk diproses");const d=await new A.FPGrowth(F/100).exec(u),l=u.length,c=new Map;d.forEach(n=>{const e=n.support/l*100;c.set(n.items.sort().join(","),e)});const x=[],p=new Set;d.forEach(n=>{if(n.items.length<2)return;const e=n.items;for(let s=1;s<(1<<e.length)-1;s++){const r=[],i=[];for(let m=0;m<e.length;m++)s&1<<m?r.push(e[m]):i.push(e[m]);if(i.length!==1)continue;const a=[...r,...i].sort().join(",");if(p.has(a))continue;p.add(a);const K=r.sort().join(","),E=c.get(K);if(!E)continue;const q=n.support/(E*l/100)*100;q>=I&&x.push({antecedent:r,consequent:i[0],confidence:q,support:n.support/l*100})}});const C=["hasil_panen_tinggi","hasil_panen_rendah","hasil_panen_sedang"],S=x.sort((n,e)=>e.confidence-n.confidence||e.support-n.support),j=H(S);G(j),P(S),w&&w(j.antecedents)}catch(o){k(o instanceof Error?o.message:"Terjadi kesalahan saat memproses data"),console.error("FP-Growth Error:",o)}finally{b(!1),f.current&&clearTimeout(f.current)}};h.useEffect(()=>{B()},[u]);const H=o=>{const d={},l={},c={};o.forEach(n=>{const{antecedent:e,consequent:s,confidence:r,support:i}=n;e.forEach(a=>{d[a]||(d[a]={count:0,confidenceSum:0,supportSum:0}),d[a].count+=1,d[a].confidenceSum+=r,d[a].supportSum+=i,c[a]||(c[a]={count:0,confidenceSum:0,supportSum:0}),c[a].count+=1,c[a].confidenceSum+=r,c[a].supportSum+=i}),l[s]||(l[s]={count:0,confidenceSum:0,supportSum:0}),l[s].count+=1,l[s].confidenceSum+=r,l[s].supportSum+=i,c[s]||(c[s]={count:0,confidenceSum:0,supportSum:0}),c[s].count+=1,c[s].confidenceSum+=r,c[s].supportSum+=i});const x=(n,e)=>e.avgConfidence!==n.avgConfidence?e.avgConfidence-n.avgConfidence:e.avgSupport!==n.avgSupport?e.avgSupport-n.avgSupport:e.count-n.count,p=n=>Object.entries(n).filter(([e])=>!e.includes("hasil")).map(([e,{count:s,confidenceSum:r,supportSum:i}])=>({name:e,count:s,avgConfidence:r/s,avgSupport:i/s,weightedScore:(r*.6+i*.4)/s})).sort(x),C=p(d).slice(0,5),S=p(l).slice(0,8),j=p(c).slice(0,5);return{antecedents:C,consequents:S,overall:j,highestConfidenceRule:o.length>0?[...o].sort((n,e)=>e.confidence-n.confidence||e.support-n.support)[0]:null,highestSupportRule:o.length>0?[...o].sort((n,e)=>e.support-n.support||e.confidence-n.confidence)[0]:null}};return t.jsxs("div",{className:"max-w-auto mx-auto px-4 py-12 sm:px-6 lg:px-8",children:[u.length===0&&t.jsx("div",{className:"mb-6 rounded-md bg-yellow-50 p-4 text-yellow-800",children:"Tidak ada data transaksi untuk diproses"}),v&&t.jsx("div",{className:"mb-6 rounded-md bg-red-50 p-4 text-red-800",children:v}),!T&&g.length>0&&t.jsx("div",{className:"space-y-8",children:t.jsxs("div",{children:[t.jsxs("h3",{className:"mb-2 text-lg font-medium text-gray-900",children:["Aturan ",_," (",g.length," ditemukan)"]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs(L,{className:"min-w-full divide-y divide-gray-200",children:[t.jsx(M,{className:"bg-gray-50",children:t.jsxs(R,{children:[t.jsx(y,{className:"w-2/3",children:"Aturan"}),t.jsx(y,{className:"text-center",children:"Confidence"}),t.jsx(y,{className:"text-center",children:"Support"})]})}),t.jsx(z,{className:"divide-y divide-gray-200",children:g.slice(0,50).map((o,d)=>t.jsxs(R,{children:[t.jsxs(N,{className:"py-3",children:[t.jsx("span",{className:"font-medium",children:"Jika "}),t.jsx("span",{className:"font-semibold text-blue-600",children:o.antecedent.join(" âˆ§ ")}),t.jsx("span",{className:"font-medium",children:" maka "}),t.jsx("span",{className:"font-semibold text-green-600",children:o.consequent})]}),t.jsxs(N,{className:"text-center",children:[o.confidence.toFixed(1),"%"]}),t.jsxs(N,{className:"text-center",children:[o.support.toFixed(1),"%"]})]},d))})]})})]})}),!T&&!v&&g.length===0&&u.length>0&&t.jsxs("div",{className:"rounded-lg bg-gray-50 p-8 text-center",children:[t.jsx("p",{className:"text-gray-600",children:"Tidak ada aturan yang ditemukan dengan threshold saat ini."}),t.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Coba turunkan nilai support atau confidence threshold."})]})]})};export{X as default};
